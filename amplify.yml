version: 1
frontend:
    phases:
        preBuild:
            commands:
                - npm ci
                - npx prisma generate
        build:
            commands:
                - env | grep -e DATABASE_URL >> .env
                - env | grep -e DIRECT_URL >> .env
                - env | grep -e FDC_API_KEY >> .env
                - env | grep -e GEMINI_API_KEY >> .env
                - env | grep -e GITHUB_ID >> .env
                - env | grep -e GITHUB_SECRET >> .env
                - env | grep -e NEXTAUTH_SECRET >> .env
                - npm run build
    artifacts:
        baseDirectory: .next
        files:
            - '**/*'
    cache:
        paths:
            - .next/cache/**/*
            - node_modules/**/*
